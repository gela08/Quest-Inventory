<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cloud Quest | Super Inventory</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --game-gold: #ffcc00;
            --game-blue: #2a34eb;
            --game-bg: #0d0d1a;
            --panel-bg: #1a1a2e;
            --text-color: #ffffff;
            --border-pixel: 6px;
        }

        /* Scanline Overlay for Game Feel */
        body::before {
            content: " ";
            display: block;
            position: fixed;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 200;
            background-size: 100% 4px, 3px 100%;
            pointer-events: none;
        }

        body {
            font-family: 'Press Start 2P', cursive;
            background-color: var(--game-bg);
            color: var(--text-color);
            margin: 0;
            padding: 40px;
            font-size: 12px;
            display: flex;
            justify-content: center;
        }

        .container {
            width: 95%;
            max-width: 1200px; /* Made much wider */
            border: var(--border-pixel) solid #fff;
            background: var(--panel-bg);
            padding: 40px;
            box-shadow: 15px 15px 0px #000;
            position: relative;
        }

        h1 {
            text-align: center;
            color: var(--game-gold);
            text-shadow: 5px 5px #ff0055;
            margin-bottom: 40px;
            font-size: 32px; /* Bigger Title */
            letter-spacing: 4px;
        }

        /* Quest Credentials */
        .settings-box {
            border: 4px solid #4e4e4e;
            padding: 25px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            background: rgba(0,0,0,0.5);
        }

        input {
            background: #000;
            border: 3px solid var(--game-gold);
            color: var(--game-gold);
            padding: 15px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            outline: none;
        }

        input:focus {
            background: #111;
            border-color: #fff;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 40px;
        }

        button {
            font-family: 'Press Start 2P', cursive;
            padding: 20px 40px; /* Bigger Buttons */
            cursor: pointer;
            border: var(--border-pixel) solid #fff;
            background: var(--game-blue);
            color: #fff;
            font-size: 14px;
            box-shadow: 6px 6px 0px #000;
            transition: all 0.1s;
        }

        button:active {
            transform: translate(3px, 3px);
            box-shadow: 3px 3px 0px #000;
        }

        .btn-upload { background: #e94560; }
        .btn-refresh { background: #0f3460; }

        #statusMessage {
            display: block;
            text-align: center;
            margin: 20px 0;
            font-size: 14px;
            color: var(--game-gold);
            height: 24px;
        }

        .inventory-label {
            color: var(--game-gold);
            font-size: 16px;
            margin-bottom: 20px;
            display: block;
            border-left: 10px solid var(--game-gold);
            padding-left: 15px;
        }

        /* Grid - Cards are bigger now */
        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
            border-top: 6px double #fff;
            padding-top: 40px;
        }

        .img-item {
            background: #16213e;
            border: 4px solid #fff;
            padding: 15px;
            text-align: center;
            transition: transform 0.2s;
        }

        .img-item:hover {
            transform: translateY(-10px);
            border-color: var(--game-gold);
            background: #1a1a2e;
        }

        .img-item img {
            width: 100%;
            height: 200px; /* Taller Images */
            object-fit: contain;
            background: #000;
            margin-bottom: 15px;
            image-rendering: pixelated;
            border: 2px solid #333;
        }

        .img-item span {
            font-size: 10px;
            display: block;
            margin-bottom: 15px;
            word-break: break-all;
            color: #fff;
            height: 30px;
            overflow: hidden;
        }

        .delete-btn {
            color: #ff4d4d;
            font-size: 10px;
            background: none;
            border: 2px solid #ff4d4d;
            padding: 8px;
            cursor: pointer;
            width: 100%;
        }

        .delete-btn:hover {
            background: #ff4d4d;
            color: #fff;
        }

        /* Empty State */
        .empty-text {
            grid-column: 1/-1;
            text-align: center;
            font-size: 14px;
            color: #4e4e4e;
            padding: 100px 0;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>QUEST INVENTORY</h1>

    <div class="settings-box">
        <input type="password" id="ghToken" placeholder="[SECRET KEY]">
        <input type="text" id="ghRepo" placeholder="[USER/REPO]">
        <input type="text" id="ghPath" placeholder="[FOLDER_PATH]">
    </div>

    <div class="controls">
        <input type="file" id="fileInput" accept="image/*" style="display: none;">
        <button class="btn-upload" onclick="document.getElementById('fileInput').click()">UPLOAD ITEM</button>
        <button class="btn-refresh" onclick="refreshList()">RELOAD GEAR</button>
    </div>
    
    <div id="statusMessage">SYSTEM IDLE...</div>

    <span class="inventory-label">EQUIPPED ITEMS</span>
    <div id="imageGallery" class="gallery">
        <p class="empty-text">- NO GEAR DETECTED IN CLOUD STORAGE -</p>
    </div>
</div>

<script>
    const statusEl = document.getElementById('statusMessage');
    const galleryEl = document.getElementById('imageGallery');

    function setStatus(msg, color = "#ffcc00") {
        statusEl.textContent = `> ${msg.toUpperCase()}`;
        statusEl.style.color = color;
    }

    async function refreshList() {
        const token = document.getElementById('ghToken').value;
        const repo = document.getElementById('ghRepo').value;
        const path = document.getElementById('ghPath').value;

        if (!token || !repo) return setStatus("KEYS MISSING!", "#ff4d4d");

        setStatus("SCANNING CLOUD...");
        try {
            const response = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                headers: { "Authorization": `token ${token}` }
            });

            if (!response.ok) throw new Error("FOLDER NOT FOUND");

            const files = await response.json();
            const imageFiles = files.filter(f => f.name.match(/\.(jpg|jpeg|png|gif|webp)$/i));

            galleryEl.innerHTML = "";
            if (imageFiles.length === 0) {
                galleryEl.innerHTML = "<p class='empty-text'>- INVENTORY EMPTY -</p>";
            }

            imageFiles.forEach(file => {
                const div = document.createElement('div');
                div.className = "img-item";
                div.innerHTML = `
                    <img src="${file.download_url}">
                    <span>${file.name}</span>
                    <button class="delete-btn" onclick="deleteFile('${file.path}', '${file.sha}')">DISCARD</button>
                `;
                galleryEl.appendChild(div);
            });
            setStatus("SCAN SUCCESSFUL", "#22c55e");
        } catch (err) {
            setStatus(err.message, "#ff4d4d");
        }
    }

    document.getElementById('fileInput').addEventListener('change', async (e) => {
        const file = e.target.files[0];
        if (!file) return;

        const token = document.getElementById('ghToken').value;
        const repo = document.getElementById('ghRepo').value;
        const path = document.getElementById('ghPath').value;

        setStatus("UPLOADING ITEM...");

        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = async () => {
            const base64Content = reader.result.split(',')[1];
            const fullPath = path ? `${path}/${file.name}` : file.name;

            try {
                let sha = null;
                const checkRes = await fetch(`https://api.github.com/repos/${repo}/contents/${fullPath}`, {
                    headers: { "Authorization": `token ${token}` }
                });
                if (checkRes.ok) {
                    const data = await checkRes.json();
                    sha = data.sha;
                }

                const res = await fetch(`https://api.github.com/repos/${repo}/contents/${fullPath}`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        message: "Item Added",
                        content: base64Content,
                        sha: sha
                    })
                });

                if (res.ok) {
                    setStatus("ITEM STORED!", "#22c55e");
                    refreshList();
                } else {
                    setStatus("STORAGE FAILED", "#ff4d4d");
                }
            } catch (err) {
                setStatus("SYSTEM ERROR", "#ff4d4d");
            }
        };
    });

    async function deleteFile(path, sha) {
        if (!confirm("Discard this item?")) return;
        const token = document.getElementById('ghToken').value;
        const repo = document.getElementById('ghRepo').value;

        try {
            const res = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                method: "DELETE",
                headers: { "Authorization": `token ${token}`, "Content-Type": "application/json" },
                body: JSON.stringify({ message: "Item dropped", sha: sha })
            });
            if (res.ok) {
                setStatus("ITEM REMOVED", "#ffcc00");
                refreshList();
            }
        } catch (err) {
            setStatus("ACTION FAILED", "#ff4d4d");
        }
    }
</script>
</body>
</html>